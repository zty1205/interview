# 进程，线程，协程

<br/>

## 简介

- 进程（Process） 是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。 程序是指令、数据及其组织形式的描述，进程是程序的实体。

- 线程（thread） 是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。

- 协程（coroutine）是一种用户态的轻量级线程，协程的调度完全由用户/程序（而不是操作系统）控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

## 关系

- 进程 = 线程 + 内存 + 文件/网络
- 线程 = 栈 + PC(程序计数器) + TLS(线程独立内存)
- 进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间
- 二者均可并发执行
- 一个线程可以多个协程，一个进程也可以单独拥有多个协程。
- 线程进程都是同步机制，而协程则是异步
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

## 通信

- 进程通过 TCP/IP 的端口来实现
- 线程通过共享的内存
- 协程如 Pub/Sub 模型，发布-订阅
