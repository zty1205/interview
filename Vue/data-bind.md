# 数据绑定原理

## 响应式原理

使用 defineReactive 函数将深度遍历一个对象（或循环遍历数组），将对象构建成响应式式对象。 明显的标志就是 \_\_ob\_\_ 属性实质是通过 Object.defineProperty 对属性（深度遍历）进行 setter 和 getter 拦截。

- get 中主要做依赖收集 dep.depend() 【子属性也收集该依赖】
- set 中主要做派发更新 （新的值才更新） dep.notify() 调用 dep 数组中每个渲染 watcher 的 update 方法更新 DOM

## 响应式对象使用应该注意哪些点

- 对象的新增属性，数组的新增元素，因为不是响应式的，所以不会触发视图渲染。 此时应该使用 $set
- 改变某一下标的元素，因为 Vue 未实现监听，所以不会触发视图渲染。 此时应该使用 $set
- 删除对象的属性，数组下标的某一元素，确保删除属性能触发视图渲染。此时应该使用 $delete

```javascript
$set(target, [index | property], value);
$delete(target, [index | property]);
```

Object.defineProperty 本身是可以监控到数组下标的变化的，但是在 Vue 中，从性能/体验的性价比考虑，尤大大就弃用了这个特性。简单说就是假设元素内容只有 4 个有意义的值，但是长度确实 1000，我们不可能为 1000 个元素做检测操作。

## vue3.0 为什么使用 Proxy 实现响应式

Vue3.0 的响应式 Proxy

- Proxy 可以劫持整个对象，并返回一个新的对象。
- Proxy 不仅可以代理对象，还可以代理数组。还可以代理动态增加的属性。

缺点：（代理模式）

- 虽然降低了系统的耦合度，但增加了系统的复杂度，掩盖或推荐了对象的行为和逻辑
