# Title

闭包和内存泄漏

<br/>

## 闭包

<br/>

> MDN 对闭包的定义为：闭包是指那些能够访问自由变量的函数。

那什么是自由变量呢？自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。

可能产生闭包的二种情况：

- 函数作为返回值，
- 函数作为参数传递

```javascript
function F() {
  let name = 'zty';
  return function () {
    console.log('name = ', name);
  };
}

function C(f) {
  let name = 'zty';
  return f(name);
}
```

优点:

- 可以读取函数内部的变量
- 另一个就是让这些变量的值始终保持在内存中，不会在函数调用后被自动清除，同时这也算是个缺点。
- 可用于模拟私有变量和方法

缺点:

- 消耗内存，影响网页性能
- 可能会引起内存泄漏（不再用到的内存，但是没有及时释放，就叫做内存泄漏）

<br/>

## 内存泄漏

<br/>

未释放本该释放的内存叫内存泄漏，他有以下几种情况：

- 意外的全局变量
- 闭包引起
- 没有清理的 DOM 元素
- 被遗忘的定时器或者回调
- 子元素存在引用引起的内存泄露（引用计数策略）

<br/>

## 如何定位内存泄漏？

<br/>

1. 先用 Performance。 当我们怀疑页面发生了内存泄漏的时候，可以先用 Performance 录制一段时间内页面的性能变化。如果录制结束后，看到内存的下限在不断升高的话，你就要注意了 —— 这里有可能发生了内存泄漏。
2. 通过 Memory 面板定位内存。

- 打开 DevTools, 切换至 Memory 面板
- 先记录一个堆内存快照（占大内存的对象是怀疑对象）
- 在你的页面上执行可能发生泄漏的操作
- 再记录一个堆内存快照
- 重复执行多几遍步骤 3
- 最后记录一个堆内存快照
- 选择最后一个堆内存快照，找到顶栏的“All objects”, 切换至”Objects allocated between snapshots 1 and 2”（也可以对 2，3 执行同样的操作）

<br/>

<br/>
