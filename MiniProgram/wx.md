# 简述小程序原理

小程序分为两个部分 webview 和 appService，webview 用来展现 UI，appService 用来处理业务逻辑、数据及接口调用，它们在两个进程中运行，通过系统层 JSBridge 实现通信，完成 UI 渲染、事件处理

在程序中，视图层和逻辑层的数据传输，实际上都是通过底层的 WeixinJSBridge，通过原生 evaluateJavaScript 实现的。 setData 要求更新的数据首先会将这个数据转化成字符串，接着将这个字符串于代码拼接成 JavaScript 脚本，最后，把拼接的内容传给 evaluateJavaScript() 去执行。当然小程序在视图更新上也是有做 虚拟 DOM 的优化的。所以从数据到达视图层的更新，并不是实时进行的

## 启动原理

- 热启动 ：假如用户已经打开了某个小程序，在一定时间内再次打开小程序的话，这个时候我们就不再需要重新启动了，这需要把我们的后台打开的小程序切换到前- 冷启动：用户首次打开小程序或被微信主动销毁再次打开的情况，此时小程序需要重新加载启动。

## WXS

wxs 是 weinxinScript 的缩写，它结合 WXML 可以构造出页面的组件结构，WXS 不依赖于运行时的基础库版本，可以在所有版本的微信小程序里运行，WXS 于 JavaSript 是不同的语言。虽然 WXS 也是逻辑代码，但是它不是运行在逻辑线程里的，它是运行在视图线程里的，通过直接操作视图数据，避免了跨线程的通讯开销。微信打造 WXS 主要是小程序的双线程架构在数据更新上有性能瓶颈，所有才打造了 WXS，虽然 WXS 可以提交视图数据的更新效率，但是，他也不是没有缺陷的，它存在以下这些问题：

- WXS 运行环境和其他 JS 代码是隔离的，因此，WXS 是不可以调用 JavaScript 代码里定义的函数的，也是不可以调用小程序提供的 wx 开头的 API 接口
- 一个模块要想对外暴露其内部的私有变量与函数，只能通过 module.exports 实现。
- WXS 函数不能作为视图模板中的事件回调句柄。
- 由于设备的差异，WXS 在 iOS 设备上运行速度要比 JS 快，大约是 2-20 倍，但是在安卓设备上，两者几乎没有差异

## 提高小程序的应用速度的方法

减少默认 data 的大小组件化方案，公用的如弹框等写个自定义的组件，然后调用

## 小程序的优点和缺点

小程序的优点：

- 无需下载
- 打开速度快
- 开发成本低
- 为用户提供良好的安全保障。发布有一套- 严格的审查流程，不能通过审查的程序无- 法发布上线
- 服务请求快

小程序的缺点：

- 依托微信，不能开发后台管理功能
- 大小限制不能超过 2M，不能打开超过 10 个- 层级的页面

## 生命周期函数

- onLoad——页面加载，调一次
- onShow——页面显示，每次打开页面都调用
- onReady——初次渲染完成，调一次
- onHide——页面隐藏，当 navigateTo 或底部 tab 切换时调用
- onUnload——页面卸载，当 redirectTo 或 navigateBack 时调用

## 参数传递

- 点击事件：给 HTML 元素中添加 data-\*属性来传递需要的值，之后通过 e.currentTarget.dataset
- 路由传参：跳转页面时通过 navigator 传递需要的参数值。在生命周期 onload 获取。
- globalData：全局变量
- storage：本地存储

## setData 的回调函数

微信小程序的 setData 实现是和 react 的 setData 实现类似的，所以它也是一个异步函数，并且有回调函数的参数，当然平时小量数据我们可能并没有感觉到它的异步，但是为了确保逻辑的正确执行，在需要用到 setData 后 data 里的数据的步骤，请写入 setData 的回调函数中，如下示例：

## 如何实现下拉刷新

- 先在 app.json 或 page.json 中配置 enablePullDownRefresh:true
- page 里用 onPullDownRefresh 函数，在下拉刷新时执行
- 在下拉函数执行时发起数据请求，请求返回后，调用 wx.stopPullDownRefresh 停止下拉刷新的状态

## bindtap 和 catchtap 的区别是什么

bindtap 不会阻止冒泡事件，catchtap 阻止冒泡

## 小程序 WXSS 与 CSS 的区别

- wxss 背景图片只能引入外链，不能使用本地图片
- 小程序样式使用 @import 引入 外联样式文件，地址为相对路径。
- 尺寸单位为 rpx , rpx 是响应式像素,可以根据屏幕宽度进行自适应。1px = 2rpx

```javascript
this.setData(
  {
    a: this.data.a++
  },
  () => {}
);
```

## app.json 全局配置文件描述

pages : 用于存放当前小程序的所有页面路径 window : 小程序所有页面的顶部背景颜色，文字颜色配置。 tabBar : 小程序底部的 Tab ,最多 5 个，最少 2 个。
